<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Sheets Form</title>
</head>
<body>
  <h2>문의하기</h2>
  <form id="myForm">
    이름: <input type="text" name="name"><br>
    이메일: <input type="email" name="email"><br>
    메시지: <textarea name="message"></textarea><br>
    <button type="submit">보내기</button>
  </form>

  <h3>저장된 데이터</h3>
  <ul id="dataList"></ul>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyPgZqCt2UQVHCbE7Ht2v09kEmw1-rFCXSndYeirJR0ZgmjCLiiCkomP8l5pdEsV_y8JA/exec";

    // 데이터 전송
    document.getElementById("myForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = {
        name: e.target.name.value,
        email: e.target.email.value,
        message: e.target.message.value
      };
      await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify(formData)
      });
      alert("저장 완료!");
      loadData();
    });

    // 데이터 불러오기
    async function loadData() {
      const res = await fetch(API_URL);
      const data = await res.json();
      const list = document.getElementById("dataList");
      list.innerHTML = "";

      data.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${item.name} - ${item.email}: ${item.message}
          <button onclick="editData(${item.id}, '${item.name}', '${item.email}', '${item.message}')">수정</button>
          <button onclick="deleteData(${item.id})">삭제</button>
        `;
        list.appendChild(li);
      });
    }

    // 수정 요청
    async function editData(id, name, email, message) {
      const newName = prompt("이름 수정:", name);
      const newEmail = prompt("이메일 수정:", email);
      const newMessage = prompt("메시지 수정:", message);
      
      if (newName && newEmail && newMessage) {
        await fetch(API_URL, {
          method: "PUT",
          body: JSON.stringify({ id, name: newName, email: newEmail, message: newMessage })
        });
        loadData();
      }
    }

    // 삭제 요청
    async function deleteData(id) {
      if (confirm("정말 삭제할까요?")) {
        await fetch(API_URL + "?id=" + id, { method: "DELETE" });
        loadData();
      }
    }

    // 초기 로드
    loadData();
  </script>
</body>
</html>
